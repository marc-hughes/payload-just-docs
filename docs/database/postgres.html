<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/adeeaed65336a824.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/adeeaed65336a824.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd8027ecb5121007.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-fae63b21a27d6472.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-04104d75f6814829.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-2747846ed27f1501.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/docs/%5B...slug%5D-e023289636109d90.js" defer="" crossorigin=""></script><script src="/_next/static/rEpVRygLyV6yJ0i_Ohw0C/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/rEpVRygLyV6yJ0i_Ohw0C/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="container mx-auto px-4 py-8 max-w-4xl"><h1 class="text-4xl font-bold mb-4">Postgres</h1><p class="text-xl text-gray-600 mb-8">Payload supports Postgres through an officially supported Drizzle Database Adapter.</p><div class="prose prose-lg max-w-none"><p>To use Payload with Postgres, install the package <code>@payloadcms/db-postgres</code>. It leverages Drizzle ORM and <code>node-postgres</code> to interact with a Postgres database that you provide.</p>
<p>Alternatively, the <code>@payloadcms/db-vercel-postgres</code> package is also available and is optimized for use with Vercel.</p>
<p>It automatically manages changes to your database for you in development mode, and exposes a full suite of migration controls for you to leverage in order to keep other database environments in sync with your schema. DDL transformations are automatically generated.</p>
<p>To configure Payload to use Postgres, pass the <code>postgresAdapter</code> to your Payload Config as follows:</p>
<h3>Usage</h3>
<p><code>@payloadcms/db-postgres</code>:</p>
<pre><code class="language-ts">import { postgresAdapter } from &#x27;@payloadcms/db-postgres&#x27;

export default buildConfig({
  // Configure the Postgres adapter here
  db: postgresAdapter({
    // Postgres-specific arguments go here.
    // `pool` is required.
    pool: {
      connectionString: process.env.DATABASE_URI,
    },
  }),
})
</code></pre>
<p><code>@payloadcms/db-vercel-postgres</code>:</p>
<pre><code class="language-ts">import { vercelPostgresAdapter } from &#x27;@payloadcms/db-vercel-postgres&#x27;

export default buildConfig({
  // Automatically uses proces.env.POSTGRES_URL if no options are provided.
  db: vercelPostgresAdapter(),
  // Optionally, can accept the same options as the @vercel/postgres package.
  db: vercelPostgresAdapter({
    pool: {
      connectionString: process.env.DATABASE_URL,
    },
  }),
})
</code></pre>
<div class="p-4 my-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><p><strong>Note:</strong> If you&#x27;re using <code>vercelPostgresAdapter</code> your
<code>process.env.POSTGRES_URL</code> or <code>pool.connectionString</code> points to a local
database (e.g hostname has <code>localhost</code> or <code>127.0.0.1</code>) we use the <code>pg</code> module
for pooling instead of <code>@vercel/postgres</code>. This is because <code>@vercel/postgres</code>
doesn&#x27;t work with local databases, if you want to disable that behavior, you
can pass <code>forceUseVercelPostgres: true</code> to the adapter&#x27;s args and follow
<a href="https://vercel.com/docs/storage/vercel-postgres/local-development#option-2:-local-postgres-instance-with-docker">Vercel
guide</a>
for a Docker Neon DB setup.</p></div>
<h2>Options</h2>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Option</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>pool</code> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><a href="https://orm.drizzle.team/docs/quick-postgresql/node-postgres">Pool connection options</a> that will be passed to Drizzle and <code>node-postgres</code> or to <code>@vercel/postgres</code></td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>push</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Disable Drizzle&#x27;s <a href="https://orm.drizzle.team/kit-docs/overview#prototyping-with-db-push"><code>db push</code></a> in development mode. By default, <code>push</code> is enabled for development mode only.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>migrationDir</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Customize the directory that migrations are stored.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>schemaName</code> (experimental)</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A string for the postgres schema to use, defaults to &#x27;public&#x27;.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>idType</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A string of &#x27;serial&#x27;, or &#x27;uuid&#x27; that is used for the data type given to id columns.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>transactionOptions</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A PgTransactionConfig object for transactions, or set to <code>false</code> to disable using transactions. <a href="https://orm.drizzle.team/docs/transactions">More details</a></td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>disableCreateDatabase</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Pass <code>true</code> to disable auto database creation if it doesn&#x27;t exist. Defaults to <code>false</code>.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>localesSuffix</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A string appended to the end of table names for storing localized fields. Default is &#x27;_locales&#x27;.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>relationshipsSuffix</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A string appended to the end of table names for storing relationships. Default is &#x27;_rels&#x27;.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>versionsSuffix</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A string appended to the end of table names for storing versions. Defaults to &#x27;_v&#x27;.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>beforeSchemaInit</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Drizzle schema hook. Runs before the schema is built. <a href="#beforeschemainit">More Details</a></td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>afterSchemaInit</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Drizzle schema hook. Runs after the schema is built. <a href="#afterschemainit">More Details</a></td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>generateSchemaOutputFile</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Override generated schema from <code>payload generate:db-schema</code> file path. Defaults to <code>{CWD}/src/payload-generated.schema.ts</code></td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><code>allowIDOnCreate</code></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Set to <code>true</code> to use the <code>id</code> passed in data on the create API operations without using a custom ID field.</td></tr></tbody></table></div>
<h2>Access to Drizzle</h2>
<p>After Payload is initialized, this adapter will expose the full power of Drizzle to you for use if you need it.</p>
<p>To ensure type-safety, you need to generate Drizzle schema first with:</p>
<pre><code class="language-sh">npx payload generate:db-schema
</code></pre>
<p>Then, you can access Drizzle as follows:</p>
<pre><code class="language-ts">import { posts } from &#x27;./payload-generated-schema&#x27;
// To avoid installing Drizzle, you can import everything that drizzle has from our re-export path.
import { eq, sql, and } from &#x27;@payloadcms/db-postgres/drizzle&#x27;

// Drizzle&#x27;s Querying API: https://orm.drizzle.team/docs/rqb
const posts = await payload.db.drizzle.query.posts.findMany()
// Drizzle&#x27;s Select API https://orm.drizzle.team/docs/select
const result = await payload.db.drizzle
  .select()
  .from(posts)
  .where(
    and(eq(posts.id, 50), sql`lower(${posts.title}) = &#x27;example post title&#x27;`),
  )
</code></pre>
<h2>Tables, relations, and enums</h2>
<p>In addition to exposing Drizzle directly, all of the tables, Drizzle relations, and enum configs are exposed for you via the <code>payload.db</code> property as well.</p>
<ul>
<li>Tables - <code>payload.db.tables</code></li>
<li>Enums - <code>payload.db.enums</code></li>
<li>Relations - <code>payload.db.relations</code></li>
</ul>
<h2>Prototyping in development mode</h2>
<p>Drizzle exposes two ways to work locally in development mode.</p>
<p>The first is <a href="https://orm.drizzle.team/kit-docs/overview#prototyping-with-db-push"><code>db push</code></a>, which automatically pushes changes you make to your Payload Config (and therefore, Drizzle schema) to your database so you don&#x27;t have to manually migrate every time you change your Payload Config. This only works in development mode, and should not be mixed with manually running <a href="/docs/database/migrations"><code>migrate</code></a> commands.</p>
<p>You will be warned if any changes that you make will entail data loss while in development mode. Push is enabled by default, but you can opt out if you&#x27;d like.</p>
<p>Alternatively, you can disable <code>push</code> and rely solely on migrations to keep your local database in sync with your Payload Config.</p>
<h2>Migration workflows</h2>
<p>In Postgres, migrations are a fundamental aspect of working with Payload and you should become familiar with how they work.</p>
<p>For more information about migrations, <a href="./migrations#when-to-run-migrations">click here</a>.</p>
<h2>Drizzle schema hooks</h2>
<h3>beforeSchemaInit</h3>
<p>Runs before the schema is built. You can use this hook to extend your database structure with tables that won&#x27;t be managed by Payload.</p>
<pre><code class="language-ts">import { postgresAdapter } from &#x27;@payloadcms/db-postgres&#x27;
import {
  integer,
  pgTable,
  serial,
} from &#x27;@payloadcms/db-postgres/drizzle/pg-core&#x27;

postgresAdapter({
  beforeSchemaInit: [
    ({ schema, adapter }) =&gt; {
      return {
        ...schema,
        tables: {
          ...schema.tables,
          addedTable: pgTable(&#x27;added_table&#x27;, {
            id: serial(&#x27;id&#x27;).notNull(),
          }),
        },
      }
    },
  ],
})
</code></pre>
<p>One use case is preserving your existing database structure when migrating to Payload. By default, Payload drops the current database schema, which may not be desirable in this scenario.
To quickly generate the Drizzle schema from your database you can use <a href="https://orm.drizzle.team/kit-docs/commands#introspect--pull">Drizzle Introspection</a>
You should get the <code>schema.ts</code> file which may look like this:</p>
<pre><code class="language-ts">import {
  pgTable,
  uniqueIndex,
  serial,
  varchar,
  text,
} from &#x27;drizzle-orm/pg-core&#x27;

export const users = pgTable(&#x27;users&#x27;, {
  id: serial(&#x27;id&#x27;).primaryKey(),
  fullName: text(&#x27;full_name&#x27;),
  phone: varchar(&#x27;phone&#x27;, { length: 256 }),
})

export const countries = pgTable(
  &#x27;countries&#x27;,
  {
    id: serial(&#x27;id&#x27;).primaryKey(),
    name: varchar(&#x27;name&#x27;, { length: 256 }),
  },
  (countries) =&gt; {
    return {
      nameIndex: uniqueIndex(&#x27;name_idx&#x27;).on(countries.name),
    }
  },
)
</code></pre>
<p>You can import them into your config and append to the schema with the <code>beforeSchemaInit</code> hook like this:</p>
<pre><code class="language-ts">import { postgresAdapter } from &#x27;@payloadcms/db-postgres&#x27;
import { users, countries } from &#x27;../drizzle/schema&#x27;

postgresAdapter({
  beforeSchemaInit: [
    ({ schema, adapter }) =&gt; {
      return {
        ...schema,
        tables: {
          ...schema.tables,
          users,
          countries,
        },
      }
    },
  ],
})
</code></pre>
<p>Make sure Payload doesn&#x27;t overlap table names with its collections. For example, if you already have a collection with slug &quot;users&quot;, you should either change the slug or <code>dbName</code> to change the table name for this collection.</p>
<h3>afterSchemaInit</h3>
<p>Runs after the Drizzle schema is built. You can use this hook to modify the schema with features that aren&#x27;t supported by Payload, or if you want to add a column that you don&#x27;t want to be in the Payload config.
To extend a table, Payload exposes <code>extendTable</code> utillity to the args. You can refer to the <a href="https://orm.drizzle.team/docs/sql-schema-declaration">Drizzle documentation</a>.
The following example adds the <code>extra_integer_column</code> column and a composite index on <code>country</code> and <code>city</code> columns.</p>
<pre><code class="language-ts">import { postgresAdapter } from &#x27;@payloadcms/db-postgres&#x27;
import { index, integer } from &#x27;@payloadcms/db-postgres/drizzle/pg-core&#x27;
import { buildConfig } from &#x27;payload&#x27;

export default buildConfig({
  collections: [
    {
      slug: &#x27;places&#x27;,
      fields: [
        {
          name: &#x27;country&#x27;,
          type: &#x27;text&#x27;,
        },
        {
          name: &#x27;city&#x27;,
          type: &#x27;text&#x27;,
        },
      ],
    },
  ],
  db: postgresAdapter({
    afterSchemaInit: [
      ({ schema, extendTable, adapter }) =&gt; {
        extendTable({
          table: schema.tables.places,
          columns: {
            extraIntegerColumn: integer(&#x27;extra_integer_column&#x27;),
          },
          extraConfig: (table) =&gt; ({
            country_city_composite_index: index(
              &#x27;country_city_composite_index&#x27;,
            ).on(table.country, table.city),
          }),
        })

        return schema
      },
    ],
  }),
})
</code></pre>
<h3>Note for generated schema:</h3>
<p>Columns and tables, added in schema hooks won&#x27;t be added to the generated via <code>payload generate:db-schema</code> Drizzle schema.
If you want them to be there, you either have to edit this file manually or mutate the internal Payload &quot;raw&quot; SQL schema in the <code>beforeSchemaInit</code>:</p>
<pre><code class="language-ts">import { postgresAdapter } from &#x27;@payloadcms/db-postgres&#x27;

postgresAdapter({
  beforeSchemaInit: [
    ({ schema, adapter }) =&gt; {
      // Add a new table
      adapter.rawTables.myTable = {
        name: &#x27;my_table&#x27;,
        columns: {
          my_id: {
            name: &#x27;my_id&#x27;,
            type: &#x27;serial&#x27;,
            primaryKey: true,
          },
        },
      }

      // Add a new column to generated by Payload table:
      adapter.rawTables.posts.columns.customColumn = {
        name: &#x27;custom_column&#x27;,
        // Note that Payload SQL doesn&#x27;t support everything that Drizzle does.
        type: &#x27;integer&#x27;,
        notNull: true,
      }
      // Add a new index to generated by Payload table:
      adapter.rawTables.posts.indexes.customColumnIdx = {
        name: &#x27;custom_column_idx&#x27;,
        unique: true,
        on: [&#x27;custom_column&#x27;],
      }

      return schema
    },
  ],
})
</code></pre></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontMatter":{"title":"Postgres","label":"Postgres","order":50,"desc":"Payload supports Postgres through an officially supported Drizzle Database Adapter.","keywords":"Postgres, documentation, typescript, Content Management System, cms, headless, javascript, node, react, nextjs"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    h3: \"h3\",\n    pre: \"pre\",\n    strong: \"strong\",\n    a: \"a\",\n    h2: \"h2\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components), {Banner} = _components;\n  if (!Banner) _missingMdxReference(\"Banner\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"To use Payload with Postgres, install the package \", _jsx(_components.code, {\n        children: \"@payloadcms/db-postgres\"\n      }), \". It leverages Drizzle ORM and \", _jsx(_components.code, {\n        children: \"node-postgres\"\n      }), \" to interact with a Postgres database that you provide.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Alternatively, the \", _jsx(_components.code, {\n        children: \"@payloadcms/db-vercel-postgres\"\n      }), \" package is also available and is optimized for use with Vercel.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"It automatically manages changes to your database for you in development mode, and exposes a full suite of migration controls for you to leverage in order to keep other database environments in sync with your schema. DDL transformations are automatically generated.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To configure Payload to use Postgres, pass the \", _jsx(_components.code, {\n        children: \"postgresAdapter\"\n      }), \" to your Payload Config as follows:\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Usage\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"@payloadcms/db-postgres\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { postgresAdapter } from '@payloadcms/db-postgres'\\n\\nexport default buildConfig({\\n  // Configure the Postgres adapter here\\n  db: postgresAdapter({\\n    // Postgres-specific arguments go here.\\n    // `pool` is required.\\n    pool: {\\n      connectionString: process.env.DATABASE_URI,\\n    },\\n  }),\\n})\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"@payloadcms/db-vercel-postgres\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { vercelPostgresAdapter } from '@payloadcms/db-vercel-postgres'\\n\\nexport default buildConfig({\\n  // Automatically uses proces.env.POSTGRES_URL if no options are provided.\\n  db: vercelPostgresAdapter(),\\n  // Optionally, can accept the same options as the @vercel/postgres package.\\n  db: vercelPostgresAdapter({\\n    pool: {\\n      connectionString: process.env.DATABASE_URL,\\n    },\\n  }),\\n})\\n\"\n      })\n    }), \"\\n\", _jsx(Banner, {\n      type: \"info\",\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Note:\"\n        }), \" If you're using \", _jsx(_components.code, {\n          children: \"vercelPostgresAdapter\"\n        }), \" your\\n\", _jsx(_components.code, {\n          children: \"process.env.POSTGRES_URL\"\n        }), \" or \", _jsx(_components.code, {\n          children: \"pool.connectionString\"\n        }), \" points to a local\\ndatabase (e.g hostname has \", _jsx(_components.code, {\n          children: \"localhost\"\n        }), \" or \", _jsx(_components.code, {\n          children: \"127.0.0.1\"\n        }), \") we use the \", _jsx(_components.code, {\n          children: \"pg\"\n        }), \" module\\nfor pooling instead of \", _jsx(_components.code, {\n          children: \"@vercel/postgres\"\n        }), \". This is because \", _jsx(_components.code, {\n          children: \"@vercel/postgres\"\n        }), \"\\ndoesn't work with local databases, if you want to disable that behavior, you\\ncan pass \", _jsx(_components.code, {\n          children: \"forceUseVercelPostgres: true\"\n        }), \" to the adapter's args and follow\\n\", _jsx(_components.a, {\n          href: \"https://vercel.com/docs/storage/vercel-postgres/local-development#option-2:-local-postgres-instance-with-docker\",\n          children: \"Vercel\\nguide\"\n        }), \"\\nfor a Docker Neon DB setup.\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Options\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Option\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.code, {\n              children: \"pool\"\n            }), \" *\"]\n          }), _jsxs(_components.td, {\n            children: [_jsx(_components.a, {\n              href: \"https://orm.drizzle.team/docs/quick-postgresql/node-postgres\",\n              children: \"Pool connection options\"\n            }), \" that will be passed to Drizzle and \", _jsx(_components.code, {\n              children: \"node-postgres\"\n            }), \" or to \", _jsx(_components.code, {\n              children: \"@vercel/postgres\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"push\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Disable Drizzle's \", _jsx(_components.a, {\n              href: \"https://orm.drizzle.team/kit-docs/overview#prototyping-with-db-push\",\n              children: _jsx(_components.code, {\n                children: \"db push\"\n              })\n            }), \" in development mode. By default, \", _jsx(_components.code, {\n              children: \"push\"\n            }), \" is enabled for development mode only.\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"migrationDir\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Customize the directory that migrations are stored.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.code, {\n              children: \"schemaName\"\n            }), \" (experimental)\"]\n          }), _jsx(_components.td, {\n            children: \"A string for the postgres schema to use, defaults to 'public'.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"idType\"\n            })\n          }), _jsx(_components.td, {\n            children: \"A string of 'serial', or 'uuid' that is used for the data type given to id columns.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"transactionOptions\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"A PgTransactionConfig object for transactions, or set to \", _jsx(_components.code, {\n              children: \"false\"\n            }), \" to disable using transactions. \", _jsx(_components.a, {\n              href: \"https://orm.drizzle.team/docs/transactions\",\n              children: \"More details\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"disableCreateDatabase\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Pass \", _jsx(_components.code, {\n              children: \"true\"\n            }), \" to disable auto database creation if it doesn't exist. Defaults to \", _jsx(_components.code, {\n              children: \"false\"\n            }), \".\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"localesSuffix\"\n            })\n          }), _jsx(_components.td, {\n            children: \"A string appended to the end of table names for storing localized fields. Default is '_locales'.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"relationshipsSuffix\"\n            })\n          }), _jsx(_components.td, {\n            children: \"A string appended to the end of table names for storing relationships. Default is '_rels'.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"versionsSuffix\"\n            })\n          }), _jsx(_components.td, {\n            children: \"A string appended to the end of table names for storing versions. Defaults to '_v'.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"beforeSchemaInit\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Drizzle schema hook. Runs before the schema is built. \", _jsx(_components.a, {\n              href: \"#beforeschemainit\",\n              children: \"More Details\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"afterSchemaInit\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Drizzle schema hook. Runs after the schema is built. \", _jsx(_components.a, {\n              href: \"#afterschemainit\",\n              children: \"More Details\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"generateSchemaOutputFile\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Override generated schema from \", _jsx(_components.code, {\n              children: \"payload generate:db-schema\"\n            }), \" file path. Defaults to \", _jsx(_components.code, {\n              children: \"{CWD}/src/payload-generated.schema.ts\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"allowIDOnCreate\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Set to \", _jsx(_components.code, {\n              children: \"true\"\n            }), \" to use the \", _jsx(_components.code, {\n              children: \"id\"\n            }), \" passed in data on the create API operations without using a custom ID field.\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Access to Drizzle\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"After Payload is initialized, this adapter will expose the full power of Drizzle to you for use if you need it.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"To ensure type-safety, you need to generate Drizzle schema first with:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sh\",\n        children: \"npx payload generate:db-schema\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then, you can access Drizzle as follows:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { posts } from './payload-generated-schema'\\n// To avoid installing Drizzle, you can import everything that drizzle has from our re-export path.\\nimport { eq, sql, and } from '@payloadcms/db-postgres/drizzle'\\n\\n// Drizzle's Querying API: https://orm.drizzle.team/docs/rqb\\nconst posts = await payload.db.drizzle.query.posts.findMany()\\n// Drizzle's Select API https://orm.drizzle.team/docs/select\\nconst result = await payload.db.drizzle\\n  .select()\\n  .from(posts)\\n  .where(\\n    and(eq(posts.id, 50), sql`lower(${posts.title}) = 'example post title'`),\\n  )\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Tables, relations, and enums\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In addition to exposing Drizzle directly, all of the tables, Drizzle relations, and enum configs are exposed for you via the \", _jsx(_components.code, {\n        children: \"payload.db\"\n      }), \" property as well.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Tables - \", _jsx(_components.code, {\n          children: \"payload.db.tables\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Enums - \", _jsx(_components.code, {\n          children: \"payload.db.enums\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Relations - \", _jsx(_components.code, {\n          children: \"payload.db.relations\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Prototyping in development mode\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Drizzle exposes two ways to work locally in development mode.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The first is \", _jsx(_components.a, {\n        href: \"https://orm.drizzle.team/kit-docs/overview#prototyping-with-db-push\",\n        children: _jsx(_components.code, {\n          children: \"db push\"\n        })\n      }), \", which automatically pushes changes you make to your Payload Config (and therefore, Drizzle schema) to your database so you don't have to manually migrate every time you change your Payload Config. This only works in development mode, and should not be mixed with manually running \", _jsx(_components.a, {\n        href: \"/docs/database/migrations\",\n        children: _jsx(_components.code, {\n          children: \"migrate\"\n        })\n      }), \" commands.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"You will be warned if any changes that you make will entail data loss while in development mode. Push is enabled by default, but you can opt out if you'd like.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Alternatively, you can disable \", _jsx(_components.code, {\n        children: \"push\"\n      }), \" and rely solely on migrations to keep your local database in sync with your Payload Config.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Migration workflows\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In Postgres, migrations are a fundamental aspect of working with Payload and you should become familiar with how they work.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For more information about migrations, \", _jsx(_components.a, {\n        href: \"./migrations#when-to-run-migrations\",\n        children: \"click here\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Drizzle schema hooks\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"beforeSchemaInit\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Runs before the schema is built. You can use this hook to extend your database structure with tables that won't be managed by Payload.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { postgresAdapter } from '@payloadcms/db-postgres'\\nimport {\\n  integer,\\n  pgTable,\\n  serial,\\n} from '@payloadcms/db-postgres/drizzle/pg-core'\\n\\npostgresAdapter({\\n  beforeSchemaInit: [\\n    ({ schema, adapter }) =\u003e {\\n      return {\\n        ...schema,\\n        tables: {\\n          ...schema.tables,\\n          addedTable: pgTable('added_table', {\\n            id: serial('id').notNull(),\\n          }),\\n        },\\n      }\\n    },\\n  ],\\n})\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"One use case is preserving your existing database structure when migrating to Payload. By default, Payload drops the current database schema, which may not be desirable in this scenario.\\nTo quickly generate the Drizzle schema from your database you can use \", _jsx(_components.a, {\n        href: \"https://orm.drizzle.team/kit-docs/commands#introspect--pull\",\n        children: \"Drizzle Introspection\"\n      }), \"\\nYou should get the \", _jsx(_components.code, {\n        children: \"schema.ts\"\n      }), \" file which may look like this:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import {\\n  pgTable,\\n  uniqueIndex,\\n  serial,\\n  varchar,\\n  text,\\n} from 'drizzle-orm/pg-core'\\n\\nexport const users = pgTable('users', {\\n  id: serial('id').primaryKey(),\\n  fullName: text('full_name'),\\n  phone: varchar('phone', { length: 256 }),\\n})\\n\\nexport const countries = pgTable(\\n  'countries',\\n  {\\n    id: serial('id').primaryKey(),\\n    name: varchar('name', { length: 256 }),\\n  },\\n  (countries) =\u003e {\\n    return {\\n      nameIndex: uniqueIndex('name_idx').on(countries.name),\\n    }\\n  },\\n)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can import them into your config and append to the schema with the \", _jsx(_components.code, {\n        children: \"beforeSchemaInit\"\n      }), \" hook like this:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { postgresAdapter } from '@payloadcms/db-postgres'\\nimport { users, countries } from '../drizzle/schema'\\n\\npostgresAdapter({\\n  beforeSchemaInit: [\\n    ({ schema, adapter }) =\u003e {\\n      return {\\n        ...schema,\\n        tables: {\\n          ...schema.tables,\\n          users,\\n          countries,\\n        },\\n      }\\n    },\\n  ],\\n})\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Make sure Payload doesn't overlap table names with its collections. For example, if you already have a collection with slug \\\"users\\\", you should either change the slug or \", _jsx(_components.code, {\n        children: \"dbName\"\n      }), \" to change the table name for this collection.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"afterSchemaInit\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Runs after the Drizzle schema is built. You can use this hook to modify the schema with features that aren't supported by Payload, or if you want to add a column that you don't want to be in the Payload config.\\nTo extend a table, Payload exposes \", _jsx(_components.code, {\n        children: \"extendTable\"\n      }), \" utillity to the args. You can refer to the \", _jsx(_components.a, {\n        href: \"https://orm.drizzle.team/docs/sql-schema-declaration\",\n        children: \"Drizzle documentation\"\n      }), \".\\nThe following example adds the \", _jsx(_components.code, {\n        children: \"extra_integer_column\"\n      }), \" column and a composite index on \", _jsx(_components.code, {\n        children: \"country\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"city\"\n      }), \" columns.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { postgresAdapter } from '@payloadcms/db-postgres'\\nimport { index, integer } from '@payloadcms/db-postgres/drizzle/pg-core'\\nimport { buildConfig } from 'payload'\\n\\nexport default buildConfig({\\n  collections: [\\n    {\\n      slug: 'places',\\n      fields: [\\n        {\\n          name: 'country',\\n          type: 'text',\\n        },\\n        {\\n          name: 'city',\\n          type: 'text',\\n        },\\n      ],\\n    },\\n  ],\\n  db: postgresAdapter({\\n    afterSchemaInit: [\\n      ({ schema, extendTable, adapter }) =\u003e {\\n        extendTable({\\n          table: schema.tables.places,\\n          columns: {\\n            extraIntegerColumn: integer('extra_integer_column'),\\n          },\\n          extraConfig: (table) =\u003e ({\\n            country_city_composite_index: index(\\n              'country_city_composite_index',\\n            ).on(table.country, table.city),\\n          }),\\n        })\\n\\n        return schema\\n      },\\n    ],\\n  }),\\n})\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Note for generated schema:\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Columns and tables, added in schema hooks won't be added to the generated via \", _jsx(_components.code, {\n        children: \"payload generate:db-schema\"\n      }), \" Drizzle schema.\\nIf you want them to be there, you either have to edit this file manually or mutate the internal Payload \\\"raw\\\" SQL schema in the \", _jsx(_components.code, {\n        children: \"beforeSchemaInit\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import { postgresAdapter } from '@payloadcms/db-postgres'\\n\\npostgresAdapter({\\n  beforeSchemaInit: [\\n    ({ schema, adapter }) =\u003e {\\n      // Add a new table\\n      adapter.rawTables.myTable = {\\n        name: 'my_table',\\n        columns: {\\n          my_id: {\\n            name: 'my_id',\\n            type: 'serial',\\n            primaryKey: true,\\n          },\\n        },\\n      }\\n\\n      // Add a new column to generated by Payload table:\\n      adapter.rawTables.posts.columns.customColumn = {\\n        name: 'custom_column',\\n        // Note that Payload SQL doesn't support everything that Drizzle does.\\n        type: 'integer',\\n        notNull: true,\\n      }\\n      // Add a new index to generated by Payload table:\\n      adapter.rawTables.posts.indexes.customColumnIdx = {\\n        name: 'custom_column_idx',\\n        unique: true,\\n        on: ['custom_column'],\\n      }\\n\\n      return schema\\n    },\\n  ],\\n})\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/docs/[...slug]","query":{"slug":["database","postgres"]},"buildId":"rEpVRygLyV6yJ0i_Ohw0C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>