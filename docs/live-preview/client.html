<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/payload-just-docs/_next/static/css/adeeaed65336a824.css" as="style" crossorigin=""/><link rel="stylesheet" href="/payload-just-docs/_next/static/css/adeeaed65336a824.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/payload-just-docs/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/payload-just-docs/_next/static/chunks/webpack-c335844537ee4527.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/framework-fae63b21a27d6472.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/main-4b5290d5009800e1.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/pages/_app-2747846ed27f1501.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/pages/docs/%5B...slug%5D-f6932393d0a8e091.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/DHzIn8D_gRO4uRLrnkzxV/_buildManifest.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/DHzIn8D_gRO4uRLrnkzxV/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="container mx-auto px-4 py-8 max-w-4xl"><h1 class="text-4xl font-bold mb-4">Client-side Live Preview</h1><p class="text-xl text-gray-600 mb-8">Learn how to implement Live Preview in your client-side front-end application.</p><div class="prose prose-lg max-w-none"><div class="p-4 my-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><p>If your front-end application supports Server Components like the <a href="https://nextjs.org/docs/app">Next.js App
Router</a>, etc., we suggest setting up <a href="./server">server-side
Live Preview</a> instead.</p></div>
<p>While using Live Preview, the <a href="../admin/overview">Admin Panel</a> emits a new <code>window.postMessage</code> event every time your document has changed. Your front-end application can listen for these events and re-render accordingly.</p>
<p>If your front-end application is built with <a href="#react">React</a> or <a href="#vue">Vue</a>, use the <code>useLivePreview</code> hooks that Payload provides. In the future, all other major frameworks like Svelte will be officially supported. If you are using any of these frameworks today, you can still integrate with Live Preview yourself using the underlying tooling that Payload provides. See <a href="#building-your-own-hook">building your own hook</a> for more information.</p>
<p>By default, all hooks accept the following args:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Path</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>serverURL</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The URL of your Payload server.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>initialData</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The initial data of the document. The live data will be merged in as changes are made.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>depth</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The depth of the relationships to fetch. Defaults to <code>0</code>.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>apiRoute</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The path of your API route as defined in <code>routes.api</code>. Defaults to <code>/api</code>.</td></tr></tbody></table></div>
<p><em>* An asterisk denotes that a property is required.</em></p>
<p>And return the following values:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Path</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>data</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The live data of the document, merged with the initial data.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>isLoading</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A boolean that indicates whether or not the document is loading.</td></tr></tbody></table></div>
<div class="p-4 my-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><p>If your front-end is tightly coupled to required fields, you should ensure
that your UI does not break when these fields are removed. For example, if you
are rendering something like <code>data.relatedPosts[0].title</code>, your page will
break once you remove the first related post. To get around this, use
conditional logic, optional chaining, or default values in your UI where
needed. For example, <code>data?.relatedPosts?.[0]?.title</code>.</p></div>
<div class="p-4 my-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><p>It is important that the <code>depth</code> argument matches exactly with the depth of
your initial page request. The depth property is used to populated
relationships and uploads beyond their IDs. See <a href="../queries/depth">Depth</a> for
more information.</p></div>
<h2>Frameworks</h2>
<p>Live Preview will work with any front-end framework that supports the native <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage"><code>window.postMessage</code></a> API. By default, Payload officially supports the most popular frameworks, including:</p>
<ul>
<li><a href="#react">React</a></li>
<li><a href="#vue">Vue</a></li>
</ul>
<p>If your framework is not listed, you can still integrate with Live Preview using the underlying tooling that Payload provides. <a href="#building-your-own-hook">More details</a>.</p>
<h3>React</h3>
<p>If your front-end application is built with client-side <a href="https://react.dev">React</a> like <a href="https://nextjs.org/docs/pages">Next.js Pages Router</a>, you can use the <code>useLivePreview</code> hook that Payload provides.</p>
<p>First, install the <code>@payloadcms/live-preview-react</code> package:</p>
<pre><code class="language-bash">npm install @payloadcms/live-preview-react
</code></pre>
<p>Then, use the <code>useLivePreview</code> hook in your React component:</p>
<pre><code class="language-tsx">&#x27;use client&#x27;
import { useLivePreview } from &#x27;@payloadcms/live-preview-react&#x27;
import { Page as PageType } from &#x27;@/payload-types&#x27;

// Fetch the page in a server component, pass it to the client component, then thread it through the hook
// The hook will take over from there and keep the preview in sync with the changes you make
// The `data` property will contain the live data of the document
export const PageClient: React.FC&lt;{
  page: {
    title: string
  }
}&gt; = ({ page: initialPage }) =&gt; {
  const { data } = useLivePreview&lt;PageType&gt;({
    initialData: initialPage,
    serverURL: PAYLOAD_SERVER_URL,
    depth: 2,
  })

  return &lt;h1&gt;{data.title}&lt;/h1&gt;
}
</code></pre>
<div class="p-4 my-4 rounded-lg border bg-yellow-50 border-yellow-200 text-yellow-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg><p><strong>Reminder:</strong> If you are using <a href="https://react.dev/reference/rsc/server-components">React Server
Components</a>, we strongly
suggest setting up <a href="./server">server-side Live Preview</a> instead.</p></div>
<h3>Vue</h3>
<p>If your front-end application is built with <a href="https://vuejs.org">Vue 3</a> or <a href="https://nuxt.js">Nuxt 3</a>, you can use the <code>useLivePreview</code> composable that Payload provides.</p>
<p>First, install the <code>@payloadcms/live-preview-vue</code> package:</p>
<pre><code class="language-bash">npm install @payloadcms/live-preview-vue
</code></pre>
<p>Then, use the <code>useLivePreview</code> hook in your Vue component:</p>
<pre><code class="language-ts">&lt;script setup lang=&quot;ts&quot;&gt;
import type { PageData } from &#x27;~/types&#x27;;
import { defineProps } from &#x27;vue&#x27;;
import { useLivePreview } from &#x27;@payloadcms/live-preview-vue&#x27;;

// Fetch the initial data on the parent component or using async state
const props = defineProps&lt;{ initialData: PageData }&gt;();

// The hook will take over from here and keep the preview in sync with the changes you make.
// The `data` property will contain the live data of the document only when viewed from the Preview view of the Admin UI.
const { data } = useLivePreview&lt;PageData&gt;({
  initialData: props.initialData,
  serverURL: &quot;&lt;PAYLOAD_SERVER_URL&gt;&quot;,
  depth: 2,
});
&lt;/script&gt;

&lt;template&gt;
  &lt;h1&gt;{{ data.title }}&lt;/h1&gt;
&lt;/template&gt;
</code></pre>
<h2>Building your own hook</h2>
<p>No matter what front-end framework you are using, you can build your own hook using the same underlying tooling that Payload provides.</p>
<p>First, install the base <code>@payloadcms/live-preview</code> package:</p>
<pre><code class="language-bash">npm install @payloadcms/live-preview
</code></pre>
<p>This package provides the following functions:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Path</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>subscribe</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Subscribes to the Admin Panel&#x27;s <code>window.postMessage</code> events and calls the provided callback function.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>unsubscribe</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Unsubscribes from the Admin Panel&#x27;s <code>window.postMessage</code> events.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>ready</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Sends a <code>window.postMessage</code> event to the Admin Panel to indicate that the front-end is ready to receive messages.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>isLivePreviewEvent</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Checks if a <code>MessageEvent</code> originates from the Admin Panel and is a Live Preview event, i.e. debounced form state.</td></tr></tbody></table></div>
<p>The <code>subscribe</code> function takes the following args:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Path</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>callback</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A callback function that is called with <code>data</code> every time a change is made to the document.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>serverURL</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The URL of your Payload server.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>initialData</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The initial data of the document. The live data will be merged in as changes are made.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>depth</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The depth of the relationships to fetch. Defaults to <code>0</code>.</td></tr></tbody></table></div>
<p>With these functions, you can build your own hook using your front-end framework of choice:</p>
<pre><code class="language-tsx">import { subscribe, unsubscribe } from &#x27;@payloadcms/live-preview&#x27;

// To build your own hook, subscribe to Live Preview events using the `subscribe` function
// It handles everything from:
// 1. Listening to `window.postMessage` events
// 2. Merging initial data with active form state
// 3. Populating relationships and uploads
// 4. Calling the `onChange` callback with the result
// Your hook should also:
// 1. Tell the Admin Panel when it is ready to receive messages
// 2. Handle the results of the `onChange` callback to update the UI
// 3. Unsubscribe from the `window.postMessage` events when it unmounts
</code></pre>
<p>Here is an example of what the same <code>useLivePreview</code> React hook from above looks like under the hood:</p>
<pre><code class="language-tsx">import { subscribe, unsubscribe, ready } from &#x27;@payloadcms/live-preview&#x27;
import { useCallback, useEffect, useState, useRef } from &#x27;react&#x27;

export const useLivePreview = &lt;T extends any&gt;(props: {
  depth?: number
  initialData: T
  serverURL: string
}): {
  data: T
  isLoading: boolean
} =&gt; {
  const { depth = 0, initialData, serverURL } = props
  const [data, setData] = useState&lt;T&gt;(initialData)
  const [isLoading, setIsLoading] = useState&lt;boolean&gt;(true)
  const hasSentReadyMessage = useRef&lt;boolean&gt;(false)

  const onChange = useCallback((mergedData) =&gt; {
    // When a change is made, the `onChange` callback will be called with the merged data
    // Set this merged data into state so that React will re-render the UI
    setData(mergedData)
    setIsLoading(false)
  }, [])

  useEffect(() =&gt; {
    // Listen for `window.postMessage` events from the Admin Panel
    // When a change is made, the `onChange` callback will be called with the merged data
    const subscription = subscribe({
      callback: onChange,
      depth,
      initialData,
      serverURL,
    })

    // Once subscribed, send a `ready` message back up to the Admin Panel
    // This will indicate that the front-end is ready to receive messages
    if (!hasSentReadyMessage.current) {
      hasSentReadyMessage.current = true

      ready({
        serverURL,
      })
    }

    // When the component unmounts, unsubscribe from the `window.postMessage` events
    return () =&gt; {
      unsubscribe(subscription)
    }
  }, [serverURL, onChange, depth, initialData])

  return {
    data,
    isLoading,
  }
}
</code></pre>
<div class="p-4 my-4 rounded-lg border bg-blue-50 border-blue-200 text-blue-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><p>When building your own hook, ensure that the args and return values are
consistent with the ones listed at the top of this document. This will ensure
that all hooks follow the same API.</p></div>
<h2>Example</h2>
<p>For a working demonstration of this, check out the official <a href="https://github.com/payloadcms/payload/tree/main/examples/live-preview">Live Preview Example</a>. There you will find an example of a fully integrated Next.js App Router front-end that runs on the same server as Payload.</p>
<h2>Troubleshooting</h2>
<h4>Relationships and/or uploads are not populating</h4>
<p>If you are using relationships or uploads in your front-end application, and your front-end application runs on a different domain than your Payload server, you may need to configure <a href="../configuration/overview#cors">CORS</a> to allow requests to be made between the two domains. This includes sites that are running on a different port or subdomain. Similarly, if you are protecting resources behind user authentication, you may also need to configure <a href="../authentication/cookies#csrf-prevention">CSRF</a> to allow cookies to be sent between the two domains. For example:</p>
<pre><code class="language-ts">// payload.config.ts
{
  // ...
  // If your site is running on a different domain than your Payload server,
  // This will allows requests to be made between the two domains
  cors: [
    &#x27;http://localhost:3001&#x27; // Your front-end application
  ],
  // If you are protecting resources behind user authentication,
  // This will allow cookies to be sent between the two domains
  csrf: [
    &#x27;http://localhost:3001&#x27; // Your front-end application
  ],
}
</code></pre>
<h4>Relationships and/or uploads disappear after editing a document</h4>
<p>It is possible that either you are setting an improper <a href="../queries/depth"><code>depth</code></a> in your initial request and/or your <code>useLivePreview</code> hook, or they&#x27;re mismatched. Ensure that the <code>depth</code> parameter is set to the correct value, and that it matches exactly in both places. For example:</p>
<pre><code class="language-tsx">// Your initial request
const { docs } = await payload.find({
  collection: &#x27;pages&#x27;,
  depth: 1, // Ensure this is set to the proper depth for your application
  where: {
    slug: {
      equals: &#x27;home&#x27;,
    },
  },
})
</code></pre>
<pre><code class="language-tsx">// Your hook
const { data } = useLivePreview&lt;PageType&gt;({
  initialData: initialPage,
  serverURL: PAYLOAD_SERVER_URL,
  depth: 1, // Ensure this matches the depth of your initial request
})
</code></pre>
<h4>Iframe refuses to connect</h4>
<p>If your front-end application has set a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy</a> (CSP) that blocks the Admin Panel from loading your front-end application, the iframe will not be able to load your site. To resolve this, you can whitelist the Admin Panel&#x27;s domain in your CSP by setting the <code>frame-ancestors</code> directive:</p>
<pre><code class="language-plaintext">frame-ancestors: &quot;self&quot; localhost:* https://your-site.com;
</code></pre></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontMatter":{"title":"Client-side Live Preview","label":"Client-side","order":40,"desc":"Learn how to implement Live Preview in your client-side front-end application.","keywords":"live preview, frontend, react, next.js, vue, nuxt.js, svelte, hook, useLivePreview"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    code: \"code\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    strong: \"strong\",\n    em: \"em\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    h3: \"h3\",\n    pre: \"pre\",\n    h4: \"h4\"\n  }, _provideComponents(), props.components), {Banner} = _components;\n  if (!Banner) _missingMdxReference(\"Banner\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(Banner, {\n      type: \"info\",\n      children: _jsxs(_components.p, {\n        children: [\"If your front-end application supports Server Components like the \", _jsx(_components.a, {\n          href: \"https://nextjs.org/docs/app\",\n          children: \"Next.js App\\nRouter\"\n        }), \", etc., we suggest setting up \", _jsx(_components.a, {\n          href: \"./server\",\n          children: \"server-side\\nLive Preview\"\n        }), \" instead.\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"While using Live Preview, the \", _jsx(_components.a, {\n        href: \"../admin/overview\",\n        children: \"Admin Panel\"\n      }), \" emits a new \", _jsx(_components.code, {\n        children: \"window.postMessage\"\n      }), \" event every time your document has changed. Your front-end application can listen for these events and re-render accordingly.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If your front-end application is built with \", _jsx(_components.a, {\n        href: \"#react\",\n        children: \"React\"\n      }), \" or \", _jsx(_components.a, {\n        href: \"#vue\",\n        children: \"Vue\"\n      }), \", use the \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" hooks that Payload provides. In the future, all other major frameworks like Svelte will be officially supported. If you are using any of these frameworks today, you can still integrate with Live Preview yourself using the underlying tooling that Payload provides. See \", _jsx(_components.a, {\n        href: \"#building-your-own-hook\",\n        children: \"building your own hook\"\n      }), \" for more information.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"By default, all hooks accept the following args:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Path\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"serverURL\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"The URL of your Payload server.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"initialData\"\n              })\n            })\n          }), _jsx(_components.td, {\n            children: \"The initial data of the document. The live data will be merged in as changes are made.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"depth\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"The depth of the relationships to fetch. Defaults to \", _jsx(_components.code, {\n              children: \"0\"\n            }), \".\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"apiRoute\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"The path of your API route as defined in \", _jsx(_components.code, {\n              children: \"routes.api\"\n            }), \". Defaults to \", _jsx(_components.code, {\n              children: \"/api\"\n            }), \".\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.em, {\n        children: \"* An asterisk denotes that a property is required.\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"And return the following values:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Path\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"data\"\n              })\n            })\n          }), _jsx(_components.td, {\n            children: \"The live data of the document, merged with the initial data.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"isLoading\"\n              })\n            })\n          }), _jsx(_components.td, {\n            children: \"A boolean that indicates whether or not the document is loading.\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(Banner, {\n      type: \"info\",\n      children: _jsxs(_components.p, {\n        children: [\"If your front-end is tightly coupled to required fields, you should ensure\\nthat your UI does not break when these fields are removed. For example, if you\\nare rendering something like \", _jsx(_components.code, {\n          children: \"data.relatedPosts[0].title\"\n        }), \", your page will\\nbreak once you remove the first related post. To get around this, use\\nconditional logic, optional chaining, or default values in your UI where\\nneeded. For example, \", _jsx(_components.code, {\n          children: \"data?.relatedPosts?.[0]?.title\"\n        }), \".\"]\n      })\n    }), \"\\n\", _jsx(Banner, {\n      type: \"info\",\n      children: _jsxs(_components.p, {\n        children: [\"It is important that the \", _jsx(_components.code, {\n          children: \"depth\"\n        }), \" argument matches exactly with the depth of\\nyour initial page request. The depth property is used to populated\\nrelationships and uploads beyond their IDs. See \", _jsx(_components.a, {\n          href: \"../queries/depth\",\n          children: \"Depth\"\n        }), \" for\\nmore information.\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Frameworks\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Live Preview will work with any front-end framework that supports the native \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\",\n        children: _jsx(_components.code, {\n          children: \"window.postMessage\"\n        })\n      }), \" API. By default, Payload officially supports the most popular frameworks, including:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#react\",\n          children: \"React\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#vue\",\n          children: \"Vue\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If your framework is not listed, you can still integrate with Live Preview using the underlying tooling that Payload provides. \", _jsx(_components.a, {\n        href: \"#building-your-own-hook\",\n        children: \"More details\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"React\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If your front-end application is built with client-side \", _jsx(_components.a, {\n        href: \"https://react.dev\",\n        children: \"React\"\n      }), \" like \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/pages\",\n        children: \"Next.js Pages Router\"\n      }), \", you can use the \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" hook that Payload provides.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, install the \", _jsx(_components.code, {\n        children: \"@payloadcms/live-preview-react\"\n      }), \" package:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"npm install @payloadcms/live-preview-react\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, use the \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" hook in your React component:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"'use client'\\nimport { useLivePreview } from '@payloadcms/live-preview-react'\\nimport { Page as PageType } from '@/payload-types'\\n\\n// Fetch the page in a server component, pass it to the client component, then thread it through the hook\\n// The hook will take over from there and keep the preview in sync with the changes you make\\n// The `data` property will contain the live data of the document\\nexport const PageClient: React.FC\u003c{\\n  page: {\\n    title: string\\n  }\\n}\u003e = ({ page: initialPage }) =\u003e {\\n  const { data } = useLivePreview\u003cPageType\u003e({\\n    initialData: initialPage,\\n    serverURL: PAYLOAD_SERVER_URL,\\n    depth: 2,\\n  })\\n\\n  return \u003ch1\u003e{data.title}\u003c/h1\u003e\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(Banner, {\n      type: \"warning\",\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Reminder:\"\n        }), \" If you are using \", _jsx(_components.a, {\n          href: \"https://react.dev/reference/rsc/server-components\",\n          children: \"React Server\\nComponents\"\n        }), \", we strongly\\nsuggest setting up \", _jsx(_components.a, {\n          href: \"./server\",\n          children: \"server-side Live Preview\"\n        }), \" instead.\"]\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Vue\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If your front-end application is built with \", _jsx(_components.a, {\n        href: \"https://vuejs.org\",\n        children: \"Vue 3\"\n      }), \" or \", _jsx(_components.a, {\n        href: \"https://nuxt.js\",\n        children: \"Nuxt 3\"\n      }), \", you can use the \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" composable that Payload provides.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, install the \", _jsx(_components.code, {\n        children: \"@payloadcms/live-preview-vue\"\n      }), \" package:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"npm install @payloadcms/live-preview-vue\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, use the \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" hook in your Vue component:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"\u003cscript setup lang=\\\"ts\\\"\u003e\\nimport type { PageData } from '~/types';\\nimport { defineProps } from 'vue';\\nimport { useLivePreview } from '@payloadcms/live-preview-vue';\\n\\n// Fetch the initial data on the parent component or using async state\\nconst props = defineProps\u003c{ initialData: PageData }\u003e();\\n\\n// The hook will take over from here and keep the preview in sync with the changes you make.\\n// The `data` property will contain the live data of the document only when viewed from the Preview view of the Admin UI.\\nconst { data } = useLivePreview\u003cPageData\u003e({\\n  initialData: props.initialData,\\n  serverURL: \\\"\u003cPAYLOAD_SERVER_URL\u003e\\\",\\n  depth: 2,\\n});\\n\u003c/script\u003e\\n\\n\u003ctemplate\u003e\\n  \u003ch1\u003e{{ data.title }}\u003c/h1\u003e\\n\u003c/template\u003e\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Building your own hook\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"No matter what front-end framework you are using, you can build your own hook using the same underlying tooling that Payload provides.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, install the base \", _jsx(_components.code, {\n        children: \"@payloadcms/live-preview\"\n      }), \" package:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"npm install @payloadcms/live-preview\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This package provides the following functions:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Path\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"subscribe\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Subscribes to the Admin Panel's \", _jsx(_components.code, {\n              children: \"window.postMessage\"\n            }), \" events and calls the provided callback function.\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"unsubscribe\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Unsubscribes from the Admin Panel's \", _jsx(_components.code, {\n              children: \"window.postMessage\"\n            }), \" events.\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"ready\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Sends a \", _jsx(_components.code, {\n              children: \"window.postMessage\"\n            }), \" event to the Admin Panel to indicate that the front-end is ready to receive messages.\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"isLivePreviewEvent\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Checks if a \", _jsx(_components.code, {\n              children: \"MessageEvent\"\n            }), \" originates from the Admin Panel and is a Live Preview event, i.e. debounced form state.\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"subscribe\"\n      }), \" function takes the following args:\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Path\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"callback\"\n              })\n            }), \" *\"]\n          }), _jsxs(_components.td, {\n            children: [\"A callback function that is called with \", _jsx(_components.code, {\n              children: \"data\"\n            }), \" every time a change is made to the document.\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"serverURL\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"The URL of your Payload server.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"initialData\"\n              })\n            })\n          }), _jsx(_components.td, {\n            children: \"The initial data of the document. The live data will be merged in as changes are made.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"depth\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"The depth of the relationships to fetch. Defaults to \", _jsx(_components.code, {\n              children: \"0\"\n            }), \".\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With these functions, you can build your own hook using your front-end framework of choice:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import { subscribe, unsubscribe } from '@payloadcms/live-preview'\\n\\n// To build your own hook, subscribe to Live Preview events using the `subscribe` function\\n// It handles everything from:\\n// 1. Listening to `window.postMessage` events\\n// 2. Merging initial data with active form state\\n// 3. Populating relationships and uploads\\n// 4. Calling the `onChange` callback with the result\\n// Your hook should also:\\n// 1. Tell the Admin Panel when it is ready to receive messages\\n// 2. Handle the results of the `onChange` callback to update the UI\\n// 3. Unsubscribe from the `window.postMessage` events when it unmounts\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here is an example of what the same \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" React hook from above looks like under the hood:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import { subscribe, unsubscribe, ready } from '@payloadcms/live-preview'\\nimport { useCallback, useEffect, useState, useRef } from 'react'\\n\\nexport const useLivePreview = \u003cT extends any\u003e(props: {\\n  depth?: number\\n  initialData: T\\n  serverURL: string\\n}): {\\n  data: T\\n  isLoading: boolean\\n} =\u003e {\\n  const { depth = 0, initialData, serverURL } = props\\n  const [data, setData] = useState\u003cT\u003e(initialData)\\n  const [isLoading, setIsLoading] = useState\u003cboolean\u003e(true)\\n  const hasSentReadyMessage = useRef\u003cboolean\u003e(false)\\n\\n  const onChange = useCallback((mergedData) =\u003e {\\n    // When a change is made, the `onChange` callback will be called with the merged data\\n    // Set this merged data into state so that React will re-render the UI\\n    setData(mergedData)\\n    setIsLoading(false)\\n  }, [])\\n\\n  useEffect(() =\u003e {\\n    // Listen for `window.postMessage` events from the Admin Panel\\n    // When a change is made, the `onChange` callback will be called with the merged data\\n    const subscription = subscribe({\\n      callback: onChange,\\n      depth,\\n      initialData,\\n      serverURL,\\n    })\\n\\n    // Once subscribed, send a `ready` message back up to the Admin Panel\\n    // This will indicate that the front-end is ready to receive messages\\n    if (!hasSentReadyMessage.current) {\\n      hasSentReadyMessage.current = true\\n\\n      ready({\\n        serverURL,\\n      })\\n    }\\n\\n    // When the component unmounts, unsubscribe from the `window.postMessage` events\\n    return () =\u003e {\\n      unsubscribe(subscription)\\n    }\\n  }, [serverURL, onChange, depth, initialData])\\n\\n  return {\\n    data,\\n    isLoading,\\n  }\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(Banner, {\n      type: \"info\",\n      children: _jsx(_components.p, {\n        children: \"When building your own hook, ensure that the args and return values are\\nconsistent with the ones listed at the top of this document. This will ensure\\nthat all hooks follow the same API.\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Example\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For a working demonstration of this, check out the official \", _jsx(_components.a, {\n        href: \"https://github.com/payloadcms/payload/tree/main/examples/live-preview\",\n        children: \"Live Preview Example\"\n      }), \". There you will find an example of a fully integrated Next.js App Router front-end that runs on the same server as Payload.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Troubleshooting\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Relationships and/or uploads are not populating\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you are using relationships or uploads in your front-end application, and your front-end application runs on a different domain than your Payload server, you may need to configure \", _jsx(_components.a, {\n        href: \"../configuration/overview#cors\",\n        children: \"CORS\"\n      }), \" to allow requests to be made between the two domains. This includes sites that are running on a different port or subdomain. Similarly, if you are protecting resources behind user authentication, you may also need to configure \", _jsx(_components.a, {\n        href: \"../authentication/cookies#csrf-prevention\",\n        children: \"CSRF\"\n      }), \" to allow cookies to be sent between the two domains. For example:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"// payload.config.ts\\n{\\n  // ...\\n  // If your site is running on a different domain than your Payload server,\\n  // This will allows requests to be made between the two domains\\n  cors: [\\n    'http://localhost:3001' // Your front-end application\\n  ],\\n  // If you are protecting resources behind user authentication,\\n  // This will allow cookies to be sent between the two domains\\n  csrf: [\\n    'http://localhost:3001' // Your front-end application\\n  ],\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Relationships and/or uploads disappear after editing a document\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It is possible that either you are setting an improper \", _jsx(_components.a, {\n        href: \"../queries/depth\",\n        children: _jsx(_components.code, {\n          children: \"depth\"\n        })\n      }), \" in your initial request and/or your \", _jsx(_components.code, {\n        children: \"useLivePreview\"\n      }), \" hook, or they're mismatched. Ensure that the \", _jsx(_components.code, {\n        children: \"depth\"\n      }), \" parameter is set to the correct value, and that it matches exactly in both places. For example:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"// Your initial request\\nconst { docs } = await payload.find({\\n  collection: 'pages',\\n  depth: 1, // Ensure this is set to the proper depth for your application\\n  where: {\\n    slug: {\\n      equals: 'home',\\n    },\\n  },\\n})\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"// Your hook\\nconst { data } = useLivePreview\u003cPageType\u003e({\\n  initialData: initialPage,\\n  serverURL: PAYLOAD_SERVER_URL,\\n  depth: 1, // Ensure this matches the depth of your initial request\\n})\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Iframe refuses to connect\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If your front-end application has set a \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP\",\n        children: \"Content Security Policy\"\n      }), \" (CSP) that blocks the Admin Panel from loading your front-end application, the iframe will not be able to load your site. To resolve this, you can whitelist the Admin Panel's domain in your CSP by setting the \", _jsx(_components.code, {\n        children: \"frame-ancestors\"\n      }), \" directive:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-plaintext\",\n        children: \"frame-ancestors: \\\"self\\\" localhost:* https://your-site.com;\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/docs/[...slug]","query":{"slug":["live-preview","client"]},"buildId":"DHzIn8D_gRO4uRLrnkzxV","assetPrefix":"/payload-just-docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>