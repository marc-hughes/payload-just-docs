<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/adeeaed65336a824.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/adeeaed65336a824.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd8027ecb5121007.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-fae63b21a27d6472.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-04104d75f6814829.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-2747846ed27f1501.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/docs/%5B...slug%5D-e023289636109d90.js" defer="" crossorigin=""></script><script src="/_next/static/rEpVRygLyV6yJ0i_Ohw0C/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/rEpVRygLyV6yJ0i_Ohw0C/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="container mx-auto px-4 py-8 max-w-4xl"><h1 class="text-4xl font-bold mb-4">Custom Strategies</h1><p class="text-xl text-gray-600 mb-8">Create custom authentication strategies to handle everything auth in Payload.</p><div class="prose prose-lg max-w-none"><div class="p-4 my-4 rounded-lg border bg-yellow-50 border-yellow-200 text-yellow-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg><p>This is an advanced feature, so only attempt this if you are an experienced
developer. Otherwise, just let Payload&#x27;s built-in authentication handle user
auth for you.</p></div>
<h3>Creating a strategy</h3>
<p>At the core, a strategy is a way to authenticate a user making a request. As of <code>3.0</code> we moved away from <a href="https://www.passportjs.org">Passport</a> in favor of pulling back the curtain and putting you in full control.</p>
<p>A strategy is made up of the following:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parameter</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>name</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The name of your strategy</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>authenticate</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">A function that takes in the parameters below and returns a user or null.</td></tr></tbody></table></div>
<p>The <code>authenticate</code> function is passed the following arguments:</p>
<div class="overflow-x-auto my-8"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr class="even:bg-gray-50"><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Argument</th><th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>headers</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The headers on the incoming request. Useful for retrieving identifiable information on a request.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>payload</code></strong> *</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">The Payload class. Useful for authenticating the identifiable information against Payload.</td></tr><tr class="even:bg-gray-50"><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"><strong><code>isGraphQL</code></strong></td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500">Whether or not the request was made from a GraphQL endpoint. Default is <code>false</code>.</td></tr></tbody></table></div>
<h3>Example Strategy</h3>
<p>At its core a strategy simply takes information from the incoming request and returns a user. This is exactly how Payload&#x27;s built-in strategies function.</p>
<p>Your <code>authenticate</code> method should return an object containing a Payload user document and any optional headers that you&#x27;d like Payload to set for you when we return a response.</p>
<pre><code class="language-ts">import type { CollectionConfig } from &#x27;payload&#x27;

export const Users: CollectionConfig = {
  slug: &#x27;users&#x27;,
  auth: {
    disableLocalStrategy: true,
    // highlight-start
    strategies: [
      {
        name: &#x27;custom-strategy&#x27;,
        authenticate: ({ payload, headers }) =&gt; {
          const usersQuery = await payload.find({
            collection: &#x27;users&#x27;,
            where: {
              code: {
                equals: headers.get(&#x27;code&#x27;),
              },
              secret: {
                equals: headers.get(&#x27;secret&#x27;),
              },
            },
          })

          return {
            // Send the user with the collection slug back to authenticate,
            // or send null if no user should be authenticated
            user: usersQuery.docs[0] ? {
              collection: &#x27;users&#x27;
              ...usersQuery.docs[0],
            } : null,

            // Optionally, you can return headers
            // that you&#x27;d like Payload to set here when
            // it returns the response
            responseHeaders: new Headers({
              &#x27;some-header&#x27;: &#x27;my header value&#x27;
            })
          }
        }
      }
    ]
    // highlight-end
  },
  fields: [
    {
      name: &#x27;code&#x27;,
      type: &#x27;text&#x27;,
      index: true,
      unique: true,
    },
    {
      name: &#x27;secret&#x27;,
      type: &#x27;text&#x27;,
    },
  ]
}
</code></pre></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontMatter":{"title":"Custom Strategies","label":"Custom Strategies","order":60,"desc":"Create custom authentication strategies to handle everything auth in Payload.","keywords":"authentication, config, configuration, overview, documentation, Content Management System, cms, headless, javascript, node, react, nextjs"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h3: \"h3\",\n    code: \"code\",\n    a: \"a\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    strong: \"strong\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components), {Banner} = _components;\n  if (!Banner) _missingMdxReference(\"Banner\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(Banner, {\n      type: \"warning\",\n      children: _jsx(_components.p, {\n        children: \"This is an advanced feature, so only attempt this if you are an experienced\\ndeveloper. Otherwise, just let Payload's built-in authentication handle user\\nauth for you.\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Creating a strategy\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"At the core, a strategy is a way to authenticate a user making a request. As of \", _jsx(_components.code, {\n        children: \"3.0\"\n      }), \" we moved away from \", _jsx(_components.a, {\n        href: \"https://www.passportjs.org\",\n        children: \"Passport\"\n      }), \" in favor of pulling back the curtain and putting you in full control.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A strategy is made up of the following:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Parameter\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"name\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"The name of your strategy\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"authenticate\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"A function that takes in the parameters below and returns a user or null.\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"authenticate\"\n      }), \" function is passed the following arguments:\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Argument\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"headers\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"The headers on the incoming request. Useful for retrieving identifiable information on a request.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsxs(_components.td, {\n            children: [_jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"payload\"\n              })\n            }), \" *\"]\n          }), _jsx(_components.td, {\n            children: \"The Payload class. Useful for authenticating the identifiable information against Payload.\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.code, {\n                children: \"isGraphQL\"\n              })\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Whether or not the request was made from a GraphQL endpoint. Default is \", _jsx(_components.code, {\n              children: \"false\"\n            }), \".\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Example Strategy\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"At its core a strategy simply takes information from the incoming request and returns a user. This is exactly how Payload's built-in strategies function.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Your \", _jsx(_components.code, {\n        children: \"authenticate\"\n      }), \" method should return an object containing a Payload user document and any optional headers that you'd like Payload to set for you when we return a response.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import type { CollectionConfig } from 'payload'\\n\\nexport const Users: CollectionConfig = {\\n  slug: 'users',\\n  auth: {\\n    disableLocalStrategy: true,\\n    // highlight-start\\n    strategies: [\\n      {\\n        name: 'custom-strategy',\\n        authenticate: ({ payload, headers }) =\u003e {\\n          const usersQuery = await payload.find({\\n            collection: 'users',\\n            where: {\\n              code: {\\n                equals: headers.get('code'),\\n              },\\n              secret: {\\n                equals: headers.get('secret'),\\n              },\\n            },\\n          })\\n\\n          return {\\n            // Send the user with the collection slug back to authenticate,\\n            // or send null if no user should be authenticated\\n            user: usersQuery.docs[0] ? {\\n              collection: 'users'\\n              ...usersQuery.docs[0],\\n            } : null,\\n\\n            // Optionally, you can return headers\\n            // that you'd like Payload to set here when\\n            // it returns the response\\n            responseHeaders: new Headers({\\n              'some-header': 'my header value'\\n            })\\n          }\\n        }\\n      }\\n    ]\\n    // highlight-end\\n  },\\n  fields: [\\n    {\\n      name: 'code',\\n      type: 'text',\\n      index: true,\\n      unique: true,\\n    },\\n    {\\n      name: 'secret',\\n      type: 'text',\\n    },\\n  ]\\n}\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/docs/[...slug]","query":{"slug":["authentication","custom-strategies"]},"buildId":"rEpVRygLyV6yJ0i_Ohw0C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>