<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Deployment - Production Deployment | Payload CMS Documentation</title><meta name="description" content="When your Payload based app is ready, tested, looking great, it is time to deploy. Learn how to deploy your app and what to consider before deployment."/><meta property="og:title" content="Deployment - Production Deployment | Payload CMS Documentation"/><meta property="og:description" content="When your Payload based app is ready, tested, looking great, it is time to deploy. Learn how to deploy your app and what to consider before deployment."/><meta name="next-head-count" content="6"/><link rel="preload" href="/payload-just-docs/_next/static/css/adeeaed65336a824.css" as="style" crossorigin=""/><link rel="stylesheet" href="/payload-just-docs/_next/static/css/adeeaed65336a824.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/payload-just-docs/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/payload-just-docs/_next/static/chunks/webpack-c335844537ee4527.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/framework-fae63b21a27d6472.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/main-4b5290d5009800e1.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/pages/_app-2747846ed27f1501.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/chunks/pages/docs/%5B...slug%5D-8726031e66a50318.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/_tTBTu5tMI_qrBgEpmt0H/_buildManifest.js" defer="" crossorigin=""></script><script src="/payload-just-docs/_next/static/_tTBTu5tMI_qrBgEpmt0H/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="container mx-auto px-4 py-8 max-w-4xl"><h1 class="text-4xl font-bold mb-4">Production Deployment</h1><p class="text-xl text-gray-600 mb-8">When your Payload based app is ready, tested, looking great, it is time to deploy. Learn how to deploy your app and what to consider before deployment.</p><div class="prose prose-lg max-w-none"><div class="p-4 my-4 rounded-lg border bg-green-50 border-green-200 text-green-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><p>So you&#x27;ve developed a Payload app, it&#x27;s fully tested, and running great
locally. Now it&#x27;s time to launch. <strong>Awesome! Great work!</strong> Now, what&#x27;s next?</p></div>
<p>There are many ways to deploy Payload to a production environment. When evaluating how you will deploy Payload, you need
to consider these main aspects:</p>
<ol>
<li><a href="#basics">Basics</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#database">Your database</a></li>
<li><a href="#file-storage">Permanent File Storage</a></li>
<li><a href="#docker">Docker</a></li>
</ol>
<p>Payload can be deployed <em>anywhere that Next.js can run</em> - including Vercel, Netlify, SST, DigitalOcean, AWS, and more. Because it&#x27;s open source, you can self-host it.</p>
<p>But it&#x27;s important to remember that most Payload projects will also need a database, file storage, an email provider, and a CDN. Make sure you have all of the requirements that your project needs, no matter what deployment platform you choose.</p>
<p>Often, the easiest and fastest way to deploy Payload is to use <a href="https://payloadcms.com/new">Payload Cloud</a> â€” where you get everything you need out of the box, including:</p>
<ol>
<li>A MongoDB Atlas database</li>
<li>S3 file storage</li>
<li>Resend email service</li>
<li>Cloudflare CDN</li>
<li>Blue / green deployments</li>
<li>Logs</li>
<li>And more</li>
</ol>
<h2>Basics</h2>
<p>Payload runs fully in Next.js, so the <a href="https://nextjs.org/docs/app/building-your-application/deploying">Next.js build process</a> is used for building Payload. If you&#x27;ve used <code>create-payload-app</code> to create your project, executing the <code>build</code>
npm script will build Payload for production.</p>
<h2>Security</h2>
<p>Payload features a suite of security features that you can rely on to strengthen your application&#x27;s security. When
deploying to Production, it&#x27;s a good idea to double-check that you are making proper use of each of them.</p>
<h3>The Secret Key</h3>
<p>When you initialize Payload, you provide it with a <code>secret</code> property. This property should be impossible to guess and
extremely difficult for brute-force attacks to crack. Make sure your Production <code>secret</code> is a long, complex string.</p>
<h3>Double-check and thoroughly test all Access Control</h3>
<p>Because <em><strong>you</strong></em> are in complete control of who can do what with your data, you should double and triple-check that you
wield that power responsibly before deploying to Production.</p>
<div class="p-4 my-4 rounded-lg border bg-red-50 border-red-200 text-red-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg><p><strong>By default, all Access Control functions require that a user is successfully logged in to Payload to create, read, update, or delete data.</strong></p><p>But, if you allow public user registration, for example, you will want to make sure that your access control functions are more strict - permitting <strong>only appropriate users</strong> to perform appropriate actions.</p></div>
<h3>Running in Production</h3>
<p>Depending on where you deploy Payload, you may need to provide a start script to your deployment platform in order to start up Payload in production mode.</p>
<p>Note that this is different than running <code>next dev</code>. Generally, Next.js apps come configured with a <code>start</code> script which runs <code>next start</code>.</p>
<h3>Secure Cookie Settings</h3>
<p>You should be using an SSL certificate for production Payload instances, which means you
can <a href="/payload-just-docs/docs/authentication/overview">enable secure cookies</a> in your Authentication-enabled Collection configs.</p>
<h3>Preventing API Abuse</h3>
<p>Payload comes with a robust set of built-in anti-abuse measures, such as locking out users after X amount of failed
login attempts, GraphQL query complexity limits, max <code>depth</code> settings, and
more. <a href="/payload-just-docs/docs/production/preventing-abuse">Click here to learn more</a>.</p>
<h2>Database</h2>
<p>Payload can be used with any Postgres database or MongoDB-compatible database including AWS DocumentDB or Azure Cosmos DB. Make sure your production environment has access to the database that Payload uses.</p>
<p>Out of the box, Payload templates pass the <code>process.env.DATABASE_URI</code> environment variable to its database adapters, so make sure you&#x27;ve got that environment variable (and all others that you use) assigned in your deployment platform.</p>
<h3>DocumentDB</h3>
<p>When using AWS DocumentDB, you will need to configure connection options for authentication in the <code>connectOptions</code>
passed to the <code>mongooseAdapter</code> . You also need to set <code>connectOptions.useFacet</code> to <code>false</code> to disable use of the
unsupported <code>$facet</code> aggregation.</p>
<h3>CosmosDB</h3>
<p>When using Azure Cosmos DB, an index is needed for any field you may want to sort on. To add the sort index for all
fields that may be sorted in the admin UI use the <a href="/payload-just-docs/docs/configuration/overview">indexSortableFields</a> option.</p>
<h2>File storage</h2>
<p>If you are using Payload to <a href="/payload-just-docs/docs/upload/overview">manage file uploads</a>, you need to consider where your uploaded files
will be permanently stored. If you do not use Payload for file uploads, then this section does not impact your app
whatsoever.</p>
<h3>Persistent vs Ephemeral Filesystems</h3>
<p>Some cloud app hosts such as <a href="https://heroku.com">Heroku</a> use <code>ephemeral</code> file systems, which means that any files
uploaded to your server only last until the server restarts or shuts down. Heroku and similar providers schedule
restarts and shutdowns without your control, meaning your uploads will accidentally disappear without any way to get
them back.</p>
<p>Alternatively, persistent filesystems will never delete your files and can be trusted to reliably host uploads
perpetually.</p>
<p><strong>Popular cloud providers with ephemeral filesystems:</strong></p>
<ul>
<li>Heroku</li>
<li>DigitalOcean Apps</li>
</ul>
<p><strong>Popular cloud providers with persistent filesystems:</strong></p>
<ul>
<li>DigitalOcean Droplets</li>
<li>Amazon EC2</li>
<li>GoDaddy</li>
<li>Many other more traditional web hosts</li>
</ul>
<div class="p-4 my-4 rounded-lg border bg-red-50 border-red-200 text-red-800"><svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg><p><strong>Warning:</strong></p><p>If you rely on Payload&#x27;s <strong>Upload</strong> functionality, make sure you either use a host
with a persistent filesystem or have an integration with a third-party file host like Amazon S3.</p></div>
<h3>Using cloud storage providers</h3>
<p>If you don&#x27;t use Payload&#x27;s <code>upload</code> functionality, you can completely disregard this section.</p>
<p>But, if you do, and you still want to use an ephemeral filesystem provider, you can use one of Payload&#x27;s official cloud storage plugins or write your own to save the files your users upload to a more permanent storage solution like Amazon S3 or DigitalOcean Spaces.</p>
<p>Payload provides a list of official cloud storage adapters for you to use:</p>
<ul>
<li><a href="https://github.com/payloadcms/payload/tree/main/packages/storage-azure">Azure Blob Storage</a></li>
<li><a href="https://github.com/payloadcms/payload/tree/main/packages/storage-gcs">Google Cloud Storage</a></li>
<li><a href="https://github.com/payloadcms/payload/tree/main/packages/storage-s3">AWS S3</a></li>
<li><a href="https://github.com/payloadcms/payload/tree/main/packages/storage-uploadthing">Uploadthing</a></li>
<li><a href="https://github.com/payloadcms/payload/tree/main/packages/storage-vercel-blob">Vercel Blob Storage</a></li>
</ul>
<p>Follow the docs to configure any one of these storage providers. For local development, it might be handy to simply store uploads on your own computer, and then when it comes to production, simply enable the plugin for the cloud storage vendor of your choice.</p>
<h2>Docker</h2>
<p>This is an example of a multi-stage docker build of Payload for production. Ensure you are setting your environment
variables on deployment, like <code>PAYLOAD_SECRET</code>, <code>PAYLOAD_CONFIG_PATH</code>, and <code>DATABASE_URI</code> if needed.</p>
<p>In your Next.js config, set the <code>output</code> property <code>standalone</code>.</p>
<pre><code class="language-js">// next.config.js
const nextConfig = {
  output: &#x27;standalone&#x27;,
}
</code></pre>
<p>Dockerfile</p>
<pre><code class="language-dockerfile"># Dockerfile
# From https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile

FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies based on the preferred package manager
COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./
RUN \
  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \
  elif [ -f package-lock.json ]; then npm ci; \
  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &amp;&amp; pnpm i --frozen-lockfile; \
  else echo &quot;Lockfile not found.&quot; &amp;&amp; exit 1; \
  fi


# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Next.js collects completely anonymous telemetry data about general usage.
# Learn more here: https://nextjs.org/telemetry
# Uncomment the following line in case you want to disable telemetry during the build.
# ENV NEXT_TELEMETRY_DISABLED 1

RUN \
  if [ -f yarn.lock ]; then yarn run build; \
  elif [ -f package-lock.json ]; then npm run build; \
  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &amp;&amp; pnpm run build; \
  else echo &quot;Lockfile not found.&quot; &amp;&amp; exit 1; \
  fi

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
# Uncomment the following line in case you want to disable telemetry during runtime.
# ENV NEXT_TELEMETRY_DISABLED 1

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Set the correct permission for prerender cache
RUN mkdir .next
RUN chown nextjs:nodejs .next

# Automatically leverage output traces to reduce image size
# https://nextjs.org/docs/advanced-features/output-file-tracing
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000

# server.js is created by next build from the standalone output
# https://nextjs.org/docs/pages/api-reference/next-config-js/output
CMD HOSTNAME=&quot;0.0.0.0&quot; node server.js
</code></pre>
<h2>Docker Compose</h2>
<p>Here is an example of a docker-compose.yml file that can be used for development</p>
<pre><code class="language-yml">version: &#x27;3&#x27;

services:
  payload:
    image: node:18-alpine
    ports:
      - &#x27;3000:3000&#x27;
    volumes:
      - .:/home/node/app
      - node_modules:/home/node/app/node_modules
    working_dir: /home/node/app/
    command: sh -c &quot;corepack enable &amp;&amp; corepack prepare pnpm@latest --activate &amp;&amp; pnpm install &amp;&amp; pnpm dev&quot;
    depends_on:
      - mongo
      # - postgres
    env_file:
      - .env

  # Ensure your DATABASE_URI uses &#x27;mongo&#x27; as the hostname ie. mongodb://mongo/my-db-name
  mongo:
    image: mongo:latest
    ports:
      - &#x27;27017:27017&#x27;
    command:
      - --storageEngine=wiredTiger
    volumes:
      - data:/data/db
    logging:
      driver: none

  # Uncomment the following to use postgres
  # postgres:
  #   restart: always
  #   image: postgres:latest
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data
  #   ports:
  #     - &quot;5432:5432&quot;

volumes:
  data:
  # pgdata:
  node_modules:
</code></pre></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontMatter":{"title":"Production Deployment","label":"Deployment","order":10,"desc":"When your Payload based app is ready, tested, looking great, it is time to deploy. Learn how to deploy your app and what to consider before deployment.","keywords":"deployment, production, config, configuration, documentation, Content Management System, cms, headless, javascript, node, react, nextjs"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    strong: \"strong\",\n    ol: \"ol\",\n    li: \"li\",\n    a: \"a\",\n    em: \"em\",\n    h2: \"h2\",\n    code: \"code\",\n    h3: \"h3\",\n    ul: \"ul\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components), {Banner} = _components;\n  if (!Banner) _missingMdxReference(\"Banner\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(Banner, {\n      type: \"success\",\n      children: _jsxs(_components.p, {\n        children: [\"So you've developed a Payload app, it's fully tested, and running great\\nlocally. Now it's time to launch. \", _jsx(_components.strong, {\n          children: \"Awesome! Great work!\"\n        }), \" Now, what's next?\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There are many ways to deploy Payload to a production environment. When evaluating how you will deploy Payload, you need\\nto consider these main aspects:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#basics\",\n          children: \"Basics\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#security\",\n          children: \"Security\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#database\",\n          children: \"Your database\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#file-storage\",\n          children: \"Permanent File Storage\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"#docker\",\n          children: \"Docker\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Payload can be deployed \", _jsx(_components.em, {\n        children: \"anywhere that Next.js can run\"\n      }), \" - including Vercel, Netlify, SST, DigitalOcean, AWS, and more. Because it's open source, you can self-host it.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But it's important to remember that most Payload projects will also need a database, file storage, an email provider, and a CDN. Make sure you have all of the requirements that your project needs, no matter what deployment platform you choose.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Often, the easiest and fastest way to deploy Payload is to use \", _jsx(_components.a, {\n        href: \"https://payloadcms.com/new\",\n        children: \"Payload Cloud\"\n      }), \" â€” where you get everything you need out of the box, including:\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"A MongoDB Atlas database\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"S3 file storage\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Resend email service\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Cloudflare CDN\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Blue / green deployments\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Logs\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"And more\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Basics\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Payload runs fully in Next.js, so the \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/app/building-your-application/deploying\",\n        children: \"Next.js build process\"\n      }), \" is used for building Payload. If you've used \", _jsx(_components.code, {\n        children: \"create-payload-app\"\n      }), \" to create your project, executing the \", _jsx(_components.code, {\n        children: \"build\"\n      }), \"\\nnpm script will build Payload for production.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Security\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Payload features a suite of security features that you can rely on to strengthen your application's security. When\\ndeploying to Production, it's a good idea to double-check that you are making proper use of each of them.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"The Secret Key\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When you initialize Payload, you provide it with a \", _jsx(_components.code, {\n        children: \"secret\"\n      }), \" property. This property should be impossible to guess and\\nextremely difficult for brute-force attacks to crack. Make sure your Production \", _jsx(_components.code, {\n        children: \"secret\"\n      }), \" is a long, complex string.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Double-check and thoroughly test all Access Control\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Because \", _jsx(_components.em, {\n        children: _jsx(_components.strong, {\n          children: \"you\"\n        })\n      }), \" are in complete control of who can do what with your data, you should double and triple-check that you\\nwield that power responsibly before deploying to Production.\"]\n    }), \"\\n\", _jsxs(Banner, {\n      type: \"error\",\n      children: [_jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"By default, all Access Control functions require that a user is successfully logged in to Payload to create, read, update, or delete data.\"\n        })\n      }), _jsxs(_components.p, {\n        children: [\"But, if you allow public user registration, for example, you will want to make sure that your access control functions are more strict - permitting \", _jsx(_components.strong, {\n          children: \"only appropriate users\"\n        }), \" to perform appropriate actions.\"]\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Running in Production\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Depending on where you deploy Payload, you may need to provide a start script to your deployment platform in order to start up Payload in production mode.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Note that this is different than running \", _jsx(_components.code, {\n        children: \"next dev\"\n      }), \". Generally, Next.js apps come configured with a \", _jsx(_components.code, {\n        children: \"start\"\n      }), \" script which runs \", _jsx(_components.code, {\n        children: \"next start\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Secure Cookie Settings\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You should be using an SSL certificate for production Payload instances, which means you\\ncan \", _jsx(_components.a, {\n        href: \"/docs/authentication/overview\",\n        children: \"enable secure cookies\"\n      }), \" in your Authentication-enabled Collection configs.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Preventing API Abuse\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Payload comes with a robust set of built-in anti-abuse measures, such as locking out users after X amount of failed\\nlogin attempts, GraphQL query complexity limits, max \", _jsx(_components.code, {\n        children: \"depth\"\n      }), \" settings, and\\nmore. \", _jsx(_components.a, {\n        href: \"/docs/production/preventing-abuse\",\n        children: \"Click here to learn more\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Database\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Payload can be used with any Postgres database or MongoDB-compatible database including AWS DocumentDB or Azure Cosmos DB. Make sure your production environment has access to the database that Payload uses.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Out of the box, Payload templates pass the \", _jsx(_components.code, {\n        children: \"process.env.DATABASE_URI\"\n      }), \" environment variable to its database adapters, so make sure you've got that environment variable (and all others that you use) assigned in your deployment platform.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"DocumentDB\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When using AWS DocumentDB, you will need to configure connection options for authentication in the \", _jsx(_components.code, {\n        children: \"connectOptions\"\n      }), \"\\npassed to the \", _jsx(_components.code, {\n        children: \"mongooseAdapter\"\n      }), \" . You also need to set \", _jsx(_components.code, {\n        children: \"connectOptions.useFacet\"\n      }), \" to \", _jsx(_components.code, {\n        children: \"false\"\n      }), \" to disable use of the\\nunsupported \", _jsx(_components.code, {\n        children: \"$facet\"\n      }), \" aggregation.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"CosmosDB\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When using Azure Cosmos DB, an index is needed for any field you may want to sort on. To add the sort index for all\\nfields that may be sorted in the admin UI use the \", _jsx(_components.a, {\n        href: \"/docs/configuration/overview\",\n        children: \"indexSortableFields\"\n      }), \" option.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"File storage\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you are using Payload to \", _jsx(_components.a, {\n        href: \"/docs/upload/overview\",\n        children: \"manage file uploads\"\n      }), \", you need to consider where your uploaded files\\nwill be permanently stored. If you do not use Payload for file uploads, then this section does not impact your app\\nwhatsoever.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Persistent vs Ephemeral Filesystems\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Some cloud app hosts such as \", _jsx(_components.a, {\n        href: \"https://heroku.com\",\n        children: \"Heroku\"\n      }), \" use \", _jsx(_components.code, {\n        children: \"ephemeral\"\n      }), \" file systems, which means that any files\\nuploaded to your server only last until the server restarts or shuts down. Heroku and similar providers schedule\\nrestarts and shutdowns without your control, meaning your uploads will accidentally disappear without any way to get\\nthem back.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Alternatively, persistent filesystems will never delete your files and can be trusted to reliably host uploads\\nperpetually.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Popular cloud providers with ephemeral filesystems:\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Heroku\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"DigitalOcean Apps\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Popular cloud providers with persistent filesystems:\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"DigitalOcean Droplets\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Amazon EC2\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"GoDaddy\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Many other more traditional web hosts\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(Banner, {\n      type: \"error\",\n      children: [_jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Warning:\"\n        })\n      }), _jsxs(_components.p, {\n        children: [\"If you rely on Payload's \", _jsx(_components.strong, {\n          children: \"Upload\"\n        }), \" functionality, make sure you either use a host\\nwith a persistent filesystem or have an integration with a third-party file host like Amazon S3.\"]\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Using cloud storage providers\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you don't use Payload's \", _jsx(_components.code, {\n        children: \"upload\"\n      }), \" functionality, you can completely disregard this section.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But, if you do, and you still want to use an ephemeral filesystem provider, you can use one of Payload's official cloud storage plugins or write your own to save the files your users upload to a more permanent storage solution like Amazon S3 or DigitalOcean Spaces.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Payload provides a list of official cloud storage adapters for you to use:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/payloadcms/payload/tree/main/packages/storage-azure\",\n          children: \"Azure Blob Storage\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/payloadcms/payload/tree/main/packages/storage-gcs\",\n          children: \"Google Cloud Storage\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/payloadcms/payload/tree/main/packages/storage-s3\",\n          children: \"AWS S3\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/payloadcms/payload/tree/main/packages/storage-uploadthing\",\n          children: \"Uploadthing\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/payloadcms/payload/tree/main/packages/storage-vercel-blob\",\n          children: \"Vercel Blob Storage\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Follow the docs to configure any one of these storage providers. For local development, it might be handy to simply store uploads on your own computer, and then when it comes to production, simply enable the plugin for the cloud storage vendor of your choice.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Docker\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This is an example of a multi-stage docker build of Payload for production. Ensure you are setting your environment\\nvariables on deployment, like \", _jsx(_components.code, {\n        children: \"PAYLOAD_SECRET\"\n      }), \", \", _jsx(_components.code, {\n        children: \"PAYLOAD_CONFIG_PATH\"\n      }), \", and \", _jsx(_components.code, {\n        children: \"DATABASE_URI\"\n      }), \" if needed.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In your Next.js config, set the \", _jsx(_components.code, {\n        children: \"output\"\n      }), \" property \", _jsx(_components.code, {\n        children: \"standalone\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-js\",\n        children: \"// next.config.js\\nconst nextConfig = {\\n  output: 'standalone',\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Dockerfile\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"# Dockerfile\\n# From https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile\\n\\nFROM node:18-alpine AS base\\n\\n# Install dependencies only when needed\\nFROM base AS deps\\n# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.\\nRUN apk add --no-cache libc6-compat\\nWORKDIR /app\\n\\n# Install dependencies based on the preferred package manager\\nCOPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./\\nRUN \\\\\\n  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \\\\\\n  elif [ -f package-lock.json ]; then npm ci; \\\\\\n  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm \u0026\u0026 pnpm i --frozen-lockfile; \\\\\\n  else echo \\\"Lockfile not found.\\\" \u0026\u0026 exit 1; \\\\\\n  fi\\n\\n\\n# Rebuild the source code only when needed\\nFROM base AS builder\\nWORKDIR /app\\nCOPY --from=deps /app/node_modules ./node_modules\\nCOPY . .\\n\\n# Next.js collects completely anonymous telemetry data about general usage.\\n# Learn more here: https://nextjs.org/telemetry\\n# Uncomment the following line in case you want to disable telemetry during the build.\\n# ENV NEXT_TELEMETRY_DISABLED 1\\n\\nRUN \\\\\\n  if [ -f yarn.lock ]; then yarn run build; \\\\\\n  elif [ -f package-lock.json ]; then npm run build; \\\\\\n  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm \u0026\u0026 pnpm run build; \\\\\\n  else echo \\\"Lockfile not found.\\\" \u0026\u0026 exit 1; \\\\\\n  fi\\n\\n# Production image, copy all the files and run next\\nFROM base AS runner\\nWORKDIR /app\\n\\nENV NODE_ENV production\\n# Uncomment the following line in case you want to disable telemetry during runtime.\\n# ENV NEXT_TELEMETRY_DISABLED 1\\n\\nRUN addgroup --system --gid 1001 nodejs\\nRUN adduser --system --uid 1001 nextjs\\n\\nCOPY --from=builder /app/public ./public\\n\\n# Set the correct permission for prerender cache\\nRUN mkdir .next\\nRUN chown nextjs:nodejs .next\\n\\n# Automatically leverage output traces to reduce image size\\n# https://nextjs.org/docs/advanced-features/output-file-tracing\\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\\n\\nUSER nextjs\\n\\nEXPOSE 3000\\n\\nENV PORT 3000\\n\\n# server.js is created by next build from the standalone output\\n# https://nextjs.org/docs/pages/api-reference/next-config-js/output\\nCMD HOSTNAME=\\\"0.0.0.0\\\" node server.js\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Docker Compose\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is an example of a docker-compose.yml file that can be used for development\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-yml\",\n        children: \"version: '3'\\n\\nservices:\\n  payload:\\n    image: node:18-alpine\\n    ports:\\n      - '3000:3000'\\n    volumes:\\n      - .:/home/node/app\\n      - node_modules:/home/node/app/node_modules\\n    working_dir: /home/node/app/\\n    command: sh -c \\\"corepack enable \u0026\u0026 corepack prepare pnpm@latest --activate \u0026\u0026 pnpm install \u0026\u0026 pnpm dev\\\"\\n    depends_on:\\n      - mongo\\n      # - postgres\\n    env_file:\\n      - .env\\n\\n  # Ensure your DATABASE_URI uses 'mongo' as the hostname ie. mongodb://mongo/my-db-name\\n  mongo:\\n    image: mongo:latest\\n    ports:\\n      - '27017:27017'\\n    command:\\n      - --storageEngine=wiredTiger\\n    volumes:\\n      - data:/data/db\\n    logging:\\n      driver: none\\n\\n  # Uncomment the following to use postgres\\n  # postgres:\\n  #   restart: always\\n  #   image: postgres:latest\\n  #   volumes:\\n  #     - pgdata:/var/lib/postgresql/data\\n  #   ports:\\n  #     - \\\"5432:5432\\\"\\n\\nvolumes:\\n  data:\\n  # pgdata:\\n  node_modules:\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/docs/[...slug]","query":{"slug":["production","deployment"]},"buildId":"_tTBTu5tMI_qrBgEpmt0H","assetPrefix":"/payload-just-docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>