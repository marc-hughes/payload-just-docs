{"pageProps":{"frontMatter":{"title":"Drafts","label":"Drafts","order":20,"desc":"Enable drafts on collection documents or globals and build true preview environments for your data.","keywords":"version history, drafts, preview, draft, restore, publish, autosave, Content Management System, cms, headless, javascript, node, react, nextjs"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    em: \"em\",\n    img: \"img\",\n    h2: \"h2\",\n    code: \"code\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    a: \"a\",\n    strong: \"strong\",\n    ol: \"ol\",\n    li: \"li\",\n    h4: \"h4\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components), {Banner} = _components;\n  if (!Banner) _missingMdxReference(\"Banner\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Payload's Draft functionality builds on top of the Versions functionality to allow you to make changes to your collection documents and globals, but publish only when you're ready. This functionality allows you to build powerful Preview environments for your data, where you can make sure your changes look good before publishing documents.\"\n    }), \"\\n\", _jsx(Banner, {\n      type: \"warning\",\n      children: _jsx(_components.p, {\n        children: \"Drafts rely on Versions being enabled in order to function.\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"By enabling Versions with Drafts, your collections and globals can maintain \", _jsx(_components.em, {\n        children: \"newer\"\n      }), \", and \", _jsx(_components.em, {\n        children: \"unpublished\"\n      }), \" versions of your documents. It's perfect for cases where you might want to work on a document, update it and save your progress, but not necessarily make it publicly published right away. Drafts are extremely helpful when building preview implementations.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.img, {\n        src: \"/images/docs/drafts-enabled.png\",\n        alt: \"Drafts Enabled\"\n      }), \"\\n\", _jsx(_components.em, {\n        children: \"If Drafts are enabled, the typical Save button is replaced with new actions which allow you to either save a draft, or publish your changes.\"\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Options\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Collections and Globals both support the same options for configuring drafts. You can either set \", _jsx(_components.code, {\n        children: \"versions.drafts\"\n      }), \" to \", _jsx(_components.code, {\n        children: \"true\"\n      }), \", or pass an object to configure draft properties.\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Draft Option\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"autosave\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Enable \", _jsx(_components.code, {\n              children: \"autosave\"\n            }), \" to automatically save progress while documents are edited. To enable, set to \", _jsx(_components.code, {\n              children: \"true\"\n            }), \" or pass an object with \", _jsx(_components.a, {\n              href: \"/docs/versions/autosave\",\n              children: \"options\"\n            }), \".\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"schedulePublish\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Allow for editors to schedule publish / unpublish events in the future. \", _jsx(_components.a, {\n              href: \"#scheduled-publish\",\n              children: \"More\"\n            })]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"validate\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"Set \", _jsx(_components.code, {\n              children: \"validate\"\n            }), \" to \", _jsx(_components.code, {\n              children: \"true\"\n            }), \" to validate draft documents when saved. Default is \", _jsx(_components.code, {\n              children: \"false\"\n            }), \".\"]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Database changes\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"By enabling drafts on a collection or a global, Payload will \", _jsx(_components.strong, {\n        children: \"automatically inject a new field into your schema\"\n      }), \" called \", _jsx(_components.code, {\n        children: \"_status\"\n      }), \". The \", _jsx(_components.code, {\n        children: \"_status\"\n      }), \" field is used internally by Payload to store if a document is set to \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" or \", _jsx(_components.code, {\n        children: \"published\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Admin UI status indication\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Within the Admin UI, if drafts are enabled, a document can be shown with one of three \\\"statuses\\\":\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Draft\"\n        }), \" - if a document has never been published, and only draft versions of the document\\nare present\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Published\"\n        }), \" - if a document is published and there are no newer drafts available\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Changed\"\n        }), \" - if a document has been published, but there are newer drafts available\\nand not yet published\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Draft API\"\n    }), \"\\n\", _jsx(Banner, {\n      type: \"success\",\n      children: _jsx(_components.p, {\n        children: \"If drafts are enabled on your collection or global, important and powerful\\nchanges are made to your REST, GraphQL, and Local APIs that allow you to\\nspecify if you are interacting with drafts or with live documents.\"\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Updating or creating drafts\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you enable drafts on a collection or global, the \", _jsx(_components.code, {\n        children: \"create\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"update\"\n      }), \" operations for REST, GraphQL, and Local APIs expose a new option called \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" which allows you to specify if you are creating or updating a \", _jsx(_components.strong, {\n        children: \"draft\"\n      }), \", or if you're just sending your changes straight to the published document. For example, if you pass the query parameter \", _jsx(_components.code, {\n        children: \"?draft=true\"\n      }), \" to a REST \", _jsx(_components.code, {\n        children: \"create\"\n      }), \" or \", _jsx(_components.code, {\n        children: \"update\"\n      }), \" operation, your action will be treated as if you are creating a \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" and not a published document. By default, the \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" argument is set to \", _jsx(_components.code, {\n        children: \"false\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Required fields\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" is enabled while creating or updating a document, all fields are considered as not required, so that you can save drafts that are incomplete.\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Reading drafts vs. published documents\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In addition to the \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" argument within \", _jsx(_components.code, {\n        children: \"create\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"update\"\n      }), \" operations, a \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" argument is also exposed for \", _jsx(_components.code, {\n        children: \"find\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"findByID\"\n      }), \" operations.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" is set to \", _jsx(_components.code, {\n        children: \"true\"\n      }), \" while reading a document, \", _jsx(_components.strong, {\n        children: \"Payload will automatically replace returned document(s) with their newest drafts\"\n      }), \" if any newer drafts are available.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"For example, let's take the following scenario:\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"You create a new collection document and publish it right away\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"You then make some updates, and save the updates as a draft\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"You then make some further updates, and save more updates as another draft\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here, you will have a published document that resides in your main collection, and then you'll have two \", _jsx(_components.em, {\n        children: \"newer\"\n      }), \" drafts that reside in the \", _jsx(_components.code, {\n        children: \"_[collectionSlug]_versions\"\n      }), \" database collection.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you simply fetch your created document using a \", _jsx(_components.code, {\n        children: \"find\"\n      }), \" or \", _jsx(_components.code, {\n        children: \"findByID\"\n      }), \" operation, your published document will be returned and the drafts will be ignored.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"But, if you specify \", _jsx(_components.code, {\n        children: \"draft\"\n      }), \" as \", _jsx(_components.code, {\n        children: \"true\"\n      }), \", Payload will automatically replace your published document's content with content coming from the most recently saved \", _jsx(_components.code, {\n        children: \"version\"\n      }), \". In this case, as we have created \", _jsx(_components.em, {\n        children: \"two\"\n      }), \" versions in the above scenario, Payload will send back data from the newest (second) draft and your document will appear as the most recently drafted version instead of the published version.\"]\n    }), \"\\n\", _jsx(Banner, {\n      type: \"error\",\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Important:\"\n        }), \" the \", _jsx(_components.code, {\n          children: \"draft\"\n        }), \" argument on its own will not restrict documents\\nwith \", _jsx(_components.code, {\n          children: \"_status: 'draft'\"\n        }), \" from being returned from the API. You need to use\\nAccess Control to prevent documents with \", _jsx(_components.code, {\n          children: \"_status: 'draft'\"\n        }), \" from being\\nreturned to unauthenticated users. Read below for more information on how this\\nworks.\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Controlling who can see Collection drafts\"\n    }), \"\\n\", _jsx(Banner, {\n      type: \"warning\",\n      children: _jsxs(_components.p, {\n        children: [\"If you're using the \", _jsx(_components.strong, {\n          children: \"drafts\"\n        }), \" feature, it's important for you to consider who\\ncan view your drafts, and who can view only published documents. Luckily,\\nPayload makes this extremely simple and puts the power completely in your\\nhands.\"]\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Restricting draft access\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can use the \", _jsx(_components.code, {\n        children: \"read\"\n      }), \" \", _jsx(_components.a, {\n        href: \"../access-control/collections#read\",\n        children: \"Access Control\"\n      }), \" method to restrict who is able to view drafts of your documents by simply returning a \", _jsx(_components.a, {\n        href: \"/docs/queries/overview\",\n        children: \"query constraint\"\n      }), \" which restricts the documents that any given user is able to retrieve.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here is an example that utilizes the \", _jsx(_components.code, {\n        children: \"_status\"\n      }), \" field to require a user to be logged in to retrieve drafts:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import type { CollectionConfig } from 'payload'\\n\\nexport const Pages: CollectionConfig = {\\n  slug: 'pages',\\n  access: {\\n    read: ({ req }) => {\\n      // If there is a user logged in,\\n      // let them retrieve all documents\\n      if (req.user) return true\\n\\n      // If there is no user,\\n      // restrict the documents that are returned\\n      // to only those where `_status` is equal to `published`\\n      return {\\n        _status: {\\n          equals: 'published',\\n        },\\n      }\\n    },\\n  },\\n  versions: {\\n    drafts: true,\\n  },\\n  //.. the rest of the Pages config here\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(Banner, {\n      type: \"warning\",\n      children: [_jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Note regarding adding versions to an existing collection\"\n        })\n      }), _jsxs(_components.p, {\n        children: [\"If you already have a collection with documents, and you \", _jsx(_components.em, {\n          children: \"opt in\"\n        }), \" to draft functionality\\nafter you have already created existing documents, all of your old documents\\n\", _jsxs(_components.em, {\n          children: [\"will not have a \", _jsx(_components.code, {\n            children: \"_status\"\n          }), \" field\"]\n        }), \" until you resave them. For this reason, if you are\\n\", _jsx(_components.em, {\n          children: \"adding\"\n        }), \" versions into an existing collection, you might want to write your Access Control\\nfunction to allow for users to read both documents where\\n\", _jsxs(_components.strong, {\n          children: [_jsx(_components.code, {\n            children: \"_status\"\n          }), \" is equal to \", _jsx(_components.code, {\n            children: \"\\\"published\\\"\"\n          })]\n        }), \" as well as where\\n\", _jsxs(_components.strong, {\n          children: [_jsx(_components.code, {\n            children: \"_status\"\n          }), \" does not exist\"]\n        }), \".\"]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here is an example for how to write an \", _jsx(_components.a, {\n        href: \"../access-control/overview\",\n        children: \"Access Control\"\n      }), \" function that grants access to both documents where \", _jsx(_components.code, {\n        children: \"_status\"\n      }), \" is equal to \\\"published\\\" and where \", _jsx(_components.code, {\n        children: \"_status\"\n      }), \" does not exist:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-ts\",\n        children: \"import type { CollectionConfig } from 'payload'\\n\\nexport const Pages: CollectionConfig = {\\n  slug: 'pages',\\n  access: {\\n    read: ({ req }) => {\\n      // If there is a user logged in,\\n      // let them retrieve all documents\\n      if (req.user) return true\\n\\n      // If there is no user,\\n      // restrict the documents that are returned\\n      // to only those where `_status` is equal to `published`\\n      // or where `_status` does not exist\\n      return {\\n        or: [\\n          {\\n            _status: {\\n              equals: 'published',\\n            },\\n          },\\n          {\\n            _status: {\\n              exists: false,\\n            },\\n          },\\n        ],\\n      }\\n    },\\n  },\\n  versions: {\\n    drafts: true,\\n  },\\n  //.. the rest of the Pages config here\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Scheduled publish\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Payload provides for an ability to schedule publishing / unpublishing events in the future, which can be helpful if you need to set certain documents to \\\"go live\\\" at a given date in the future, or, vice versa, revert to a draft state after a certain time has passed.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can enable this functionality on both collections and globals via the \", _jsx(_components.code, {\n        children: \"versions.drafts.schedulePublish: true\"\n      }), \" property.\"]\n    }), \"\\n\", _jsx(Banner, {\n      type: \"warning\",\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Important:\"\n        }), \" if you are going to enable scheduled publish / unpublish, you\\nneed to make sure your Payload app is set up to process\\n\", _jsx(_components.a, {\n          href: \"/docs/jobs-queue/overview\",\n          children: \"Jobs\"\n        }), \". This feature works by creating a Job in the\\nbackground, which will be picked up after the job becomes available. If you do\\nnot have any mechanism in place to run jobs, your scheduled publish /\\nunpublish jobs will never be executed.\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Unpublishing drafts\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If a document is published, the Payload Admin UI will be updated to show an \\\"unpublish\\\" button at the top of the sidebar, which will \\\"unpublish\\\" the currently published document. Consider this as a way to \\\"revert\\\" a document back to a draft state. On the API side, this is done by simply setting \", _jsx(_components.code, {\n        children: \"_status: 'draft'\"\n      }), \" on any document.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Reverting to published\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If a document is published, and you have made further changes which are saved as a draft, Payload will show a \\\"revert to published\\\" button at the top of the sidebar which will allow you to reject your draft changes and \\\"revert\\\" back to the published state of the document. Your drafts will still be saved, but a new version will be created that will reflect the last published state of the document.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true}